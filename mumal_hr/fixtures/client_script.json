[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Interview Feedback",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.049822",
  "module": "Mumal HR",
  "name": "Autoset skill in interview feedback",
  "script": "frappe.ui.form.on('Interview Feedback', {\n    onload: function(frm) {\n        if (frm.is_new()) {\n            var competencies = [\n                \"Functional / Subject Knowledge\",\n                \"Vision & Strategy\",\n                \"Business Acumen\",\n                \"Teamwork & Collaboration\",\n                \"Develop Self & Team\",\n                \"Administrative/Managerial quality\",\n                \"Customer Focus\",\n                \"Innovates & Improves\",\n                \"Get Results\",\n                \"Communicate to Influence & Engage\",\n                \"Safety & Environment awareness\"\n            ];\n            var characteristics = [\n                \"Drive to Achieve\",\n                \"Learning Agility\",\n                \"Intellectual Capability\",\n                \"Managing Ambiguity\",\n                \"Emotional Maturity\"\n            ];\n\n            // Ensure the child table is initialized\n            if (!frm.doc.custom_ratings) {\n                frm.doc.custom_ratings = [];\n            }\n\n            var existing_competencies = frm.doc.custom_ratings.map(function(row) {\n                return row.competency;\n            });\n\n            for (var i = 0; i < competencies.length; i++) {\n                if (!existing_competencies.includes(competencies[i])) {\n                    var row = frm.add_child(\"custom_ratings\");\n                    row.competency = competencies[i];\n                    if (i < characteristics.length) {\n                        row.personal_characteristics = characteristics[i];\n                    }\n                }\n            }\n            frm.refresh_field(\"custom_ratings\");\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Opening",
  "enabled": 1,
  "modified": "2024-09-30 08:22:00.987797",
  "module": "Mumal HR",
  "name": "Set job title based on staffing plan",
  "script": "frappe.ui.form.on('Job Opening', {\n\tdesignation:function(frm) {\n\t\tvar plan = frm.doc.staffing_plan;\n\t\tvar desi = frm.doc.designation;\n\t\tvar req = frm.doc.job_requisition;\n\t\tif (desi){\n\t\t    frm.set_value('job_title',desi);\n    \t\tfrm.refresh_field('job_title');\n\t\t}\n\t\tif (plan){\n    \t\tvar title = plan+\"-\"+desi;\n    \t\tfrm.set_value('__newname',title);\n    \t\tfrm.refresh_field('__newname');\n\t\t} else if(req) {\n\t\t    var title = req+\"-\"+desi;\n    \t\tfrm.set_value('__newname',title);\n    \t\tfrm.refresh_field('__newname');\n\t\t}\n\t}\n})      ",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.093874",
  "module": "Mumal HR",
  "name": "Set Probation Date in Employee Master",
  "script": "frappe.ui.form.on('Employee', {\n    probation_period: function(frm) {\n        var doj = frm.doc.date_of_joining;\n        var probation_period = frm.doc.probation_period;\n\n        if (doj && probation_period) {\n            var training_probation_days = probation_period * 60;\n            var end_date = frappe.datetime.add_days(doj, training_probation_days);\n            var formatted_date = frappe.datetime.str_to_user(end_date);\n\n            frm.set_value('probation_period_end_date', formatted_date);\n            frm.refresh_field('probation_period_end_date');\n        }\n    },\n    date_of_joining: function(frm) {\n        var doj = frm.doc.date_of_joining;\n        var probation_period = frm.doc.probation_period;\n\n        if (doj && probation_period) {\n            var training_probation_days = probation_period * 60;\n            var end_date = frappe.datetime.add_days(doj, training_probation_days);\n            var formatted_date = frappe.datetime.str_to_user(end_date); \n\n            frm.set_value('probation_period_end_date', formatted_date);\n            frm.refresh_field('probation_period_end_date');\n        }\n    },\n    before_save: function(frm){\n        var resi_date = frm.doc.resignation_letter_date;\n        var notice_days = frm.doc.notice_number_of_days;\n        \n        if (resi_date && notice_days){\n            var rel_date = frappe.datetime.add_days(resi_date, notice_days);\n\n            frm.set_value('relieving_date', rel_date);\n            frm.refresh_field('relieving_date');\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Applicant",
  "enabled": 1,
  "modified": "2024-09-30 08:22:00.932322",
  "module": "Mumal HR",
  "name": "Filter interview status based on interview round in job applicant",
  "script": "frappe.ui.form.on('Job Applicant', {\n\tonload:function(frm) {\n\t\tvar interview_round = frm.doc.custom_interview_round;\n\t\tvar interview_status = frm.doc.custom_interview_status;\n\t\t\n\t\tvar interview_round_list = ['HR Round', 'Department Round', 'Management Round', 'General Round'];\n\t\tvar job_offer_list = ['Job Offer'];\n\t\t\n\t\t\n\t\tif (interview_round_list.includes(interview_round))\n\t\t{\n\t\t    frm.set_df_property('custom_interview_status', 'options', ['Pending', 'Under Review', 'Cleared', 'Rejected', 'Not Appeared']);\n\t\t}\n\t\telse if (job_offer_list.includes(interview_round))\n\t\t{\n\t\t    frm.set_df_property('custom_interview_status', 'options', ['Awaiting Response', 'Accpeted', 'Rejected']);\n\t\t}\n\t\t\n\t},\n\t\n\tcustom_interview_round:function(frm) {\n\t\tvar interview_round = frm.doc.custom_interview_round;\n\t\tvar interview_status = frm.doc.custom_interview_status;\n\t\t\n\t\tvar interview_round_list = ['HR Round', 'Department Round', 'Management Round', 'General Round'];\n\t\tvar job_offer_list = ['Job Offer'];\n\t\t\n\t\t\n\t\tif (interview_round_list.includes(interview_round))\n\t\t{\n\t\t    frm.set_df_property('custom_interview_status', 'options', ['Pending', 'Under Review', 'Cleared', 'Rejected', 'Not Appeared']);\n\t\t}\n\t\telse if (job_offer_list.includes(interview_round))\n\t\t{\n\t\t    frm.set_df_property('custom_interview_status', 'options', ['Awaiting Response', 'Accpeted', 'Rejected']);\n\t\t}\n\t\t\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Staffing Plan",
  "enabled": 1,
  "modified": "2024-09-30 08:22:00.876692",
  "module": "Mumal HR",
  "name": "Update the staffing plan hired vacancy",
  "script": "frappe.ui.form.on('Staffing Plan', {\n    refresh:function(frm) {\n        \n        var name = frm.doc.name; \n\n        \n        frm.doc.staffing_details.forEach(detail => {\n            var designation = detail.designation;\n            var child_name = detail.name;\n            console.log(name);\n            console.log(designation);\n            \n            frappe.db.get_list('Job Opening', {\n                fields: ['custom_hired_vacancy'],\n                filters: {\n                    designation: designation,\n                    staffing_plan: name\n                },\n            }).then(result => {\n                if (result.length > 0) {\n                    var customHiredVacancy = result[0].custom_hired_vacancy;\n                    console.log(customHiredVacancy);\n                    \n                    frappe.db.set_value('Staffing Plan Detail', child_name, 'custom_hired_vacancy', customHiredVacancy);\n                    frm.refresh_field('custom_hired_vacancy');\n                    \n                }\n            });\n        });\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Interview Feedback",
  "enabled": 1,
  "modified": "2024-09-30 08:22:00.820253",
  "module": "Mumal HR",
  "name": "Update date formate in interview feedback",
  "script": "frappe.ui.form.on('Interview Feedback', {\n\tinterview:function(frm) {\n\t\tvar date = frm.doc.interview;\n\t\t\n\t\tvar formatted_date = frappe.datetime.str_to_user(date);\n\t\tconsole.log(formatted_date)\n\t\t\n\t\tfrm.set_value('custom_date_of_interview', formatted_date);\n\t\tfrm.refresh_field('custom_date_of_interview');\n\t\t\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2024-09-30 08:22:00.785940",
  "module": "Mumal HR",
  "name": "Set Employee value in employee number",
  "script": "frappe.ui.form.on('Employee', {\n\temployee:function(frm) {\n\t\tvar emp = frm.doc.employee;\n\t\t\n\t\tfrm.set_value('employee_number', emp);\n\t\tfrm.refresh_field('employee_number');\n\t},\n\tbefore_save:function(frm){\n\t    var emp = frm.doc.employee;\n\t    var emp_number = frm.doc.employee_number;\n\t    \n\t    if (emp_number==null){\n\t        frm.set_value('employee_number', emp);\n\t\t    frm.refresh_field('employee_number');\n\t    }\n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2024-09-30 08:22:00.327051",
  "module": "Mumal HR",
  "name": "Merge Address in Employee Master",
  "script": "frappe.ui.form.on('Employee', {\n\tafter_save:function(frm) {\n\t\t\n\t\tvar custom_res_no = frm.doc.custom_res_no || '';\n\t\tvar custom_res_name = frm.doc.custom_res_name || '';\n\t\tvar custom_road_street = frm.doc.custom_road_street || '';\n\t\tvar custom_locality_area = frm.doc.custom_locality_area || '';\n\t\tvar custom_city = frm.doc.custom_city || '';\n\t\tvar custom_state = frm.doc.custom_state || '';\n\t\tvar custom_country = frm.doc.custom_country || '';\n\t\t\n\t\tvar current_address_parts = [\n            custom_res_no,\n            custom_res_name,\n            custom_road_street,\n            custom_locality_area,\n            custom_city,\n            custom_state,\n            custom_country\n        ];\n\t\t\n\t\t\n\t\tvar current_address = current_address_parts.filter(part => part.trim() !== '').join(' ');\n\t\t\n\t\tif (current_address) {\n            frm.set_value('current_address', current_address + '.');\n            frm.save();\n        }\n\t\t\n\t   // if (custom_res_no!=null || custom_res_name!=null|| custom_road_street!=null || custom_locality_area!=null || custom_city!=null || custom_state!=null || custom_country!=null)\n\t   // {\n\t   //     var present_address = custom_res_no + ' ' + custom_res_name + ' ' + custom_road_street + ' ' + custom_locality_area + ' ' + custom_city + ' ' + custom_state + ' ' + custom_country + '.';\n\t\t  //  console.log(present_address)\n    // \t\tfrm.set_value('current_address',present_address);\n    // \t\tfrm.save();\n\t   // }\n\t    \n\n\t\t\n\t    var custom_is_current_address = frm.doc.custom_is_current_address || '';\n\t    var custom_res_no_p = frm.doc.custom_res_no_p || '';\n\t    var custom_res_name_p = frm.doc.custom_res_name_p || '';\n\t    var custom_road_street_p = frm.doc.custom_road_street_p || '';\n\t    var custom_locality_area_p = frm.doc.custom_locality_area_p || '';\n\t    var custom_city_p = frm.doc.custom_city_p || '';\n\t    var custom_state_p = frm.doc.custom_state_p || '';\n\t    var custom_country_p = frm.doc.custom_country_p || '';\n\t    \n\t    var permanent_address_parts = [\n            custom_res_no_p,\n            custom_res_name_p,\n            custom_road_street_p,\n            custom_locality_area_p,\n            custom_city_p,\n            custom_state_p,\n            custom_country_p\n        ];\n        \n        var permanent_address = current_address_parts.filter(part => part.trim() !== '').join(' ');\n        \n\t    if (permanent_address) {\n            frm.set_value('permanent_address', permanent_address + '.');\n            frm.save();\n        }\n\t    \n\t   \n\t}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee",
  "enabled": 1,
  "modified": "2024-09-30 08:22:00.769146",
  "module": "Mumal HR",
  "name": "Set current address in employee master",
  "script": "frappe.ui.form.on('Employee', {\n\tcustom_is_current_address:function(frm) {\n        var custom_is_current_address = frm.doc.custom_is_current_address;\n        console.log(custom_is_current_address);\n        \n        if(custom_is_current_address == 1){\n            var res_no = cur_frm.doc.custom_res_no;\n            var res_name = cur_frm.doc.custom_res_name;\n            var road_street = cur_frm.doc.custom_road_street;\n            var locality_area = cur_frm.doc.custom_locality_area;\n            var city = cur_frm.doc.custom_city;\n            var state = cur_frm.doc.custom_state;\n            var country = cur_frm.doc.custom_country;\n            frm.set_value('custom_res_no_p', res_no);\n            frm.set_value('custom_res_name_p', res_name);\n            frm.set_value('custom_road_street_p', road_street);\n            frm.set_value('custom_locality_area_p', locality_area);\n            frm.set_value('custom_city_p', city);\n            frm.set_value('custom_state_p', state);\n            frm.set_value('custom_country_p', country);\n            \n        } else {\n            frm.set_value('custom_res_no_p', '');\n            frm.set_value('custom_res_name_p', '');\n            frm.set_value('custom_road_street_p', '');\n            frm.set_value('custom_locality_area_p', '');\n            frm.set_value('custom_city_p', '');\n            frm.set_value('custom_state_p', '');\n            frm.set_value('custom_country_p', '');\n        }\n        \n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Full and Final Statement",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.110189",
  "module": "Mumal HR",
  "name": "Calculate service period in full & final settlement",
  "script": "frappe.ui.form.on('Full and Final Statement', {\n    refresh: function(frm) {\n        // Flag to prevent multiple alerts\n        frm.messageShown = false;\n\n        var a = frm.doc.date_of_joining;\n        var b = frm.doc.relieving_date;\n\n        // Function to format date as dd-mm-yyyy\n        function formatDate(dateString) {\n            var date = new Date(dateString);\n            var day = String(date.getDate()).padStart(2, '0');\n            var month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based\n            var year = date.getFullYear();\n            return `${day}-${month}-${year}`;\n        }\n\n        // Function to calculate year difference as a float\n        function calculateYearDifference(date1, date2) {\n            var d1 = new Date(date1);\n            var d2 = new Date(date2);\n            var diffInMilliseconds = d2 - d1;\n            var diffInYears = diffInMilliseconds / (1000 * 60 * 60 * 24 * 365.25); // Considering leap years\n            return parseFloat(diffInYears.toFixed(1)); // Rounded to 1 decimal place\n        }\n\n        if (a && b) {\n            var formattedDateOfJoining = formatDate(a);\n            var formattedDateOfLeaving = formatDate(b);\n\n            // Calculate the year difference\n            var yearDifference = calculateYearDifference(a, b);\n\n            // Set the total_years_of_experience field with the year difference\n            frm.set_value('custom_total_service_period', yearDifference);\n            frm.refresh_field('custom_total_service_period');\n        }\n    },\n    \n    employee: function(frm) {\n        \n        var notice_days = frm.doc.custom_notice_days;\n        var rel_date = frm.doc.relieving_date;\n        var last_present_days = frm.doc.custom_last_present_day;\n        \n        if(rel_date && last_present_days && last_present_days<rel_date){\n            var date_diff = frappe.datetime.get_day_diff(rel_date, last_present_days);\n            \n            frm.set_value('custom_unserved_notice_days', date_diff);\n            frm.refresh_field('custom_unserved_notice_days');\n        }\n        \n        var payables = ['Salary Slip', 'Gratuity', 'Bonus', 'Leave Encashment'];\n        var payables_doctype = ['Salary Slip', 'Employee Gratuity', 'Employee Bonus', 'Leave Encashment'];\n        var receivables = ['Loan', 'Advance'];\n        var receivables_doctype = ['Loan', 'Employee Advance'];\n\n        \n        frm.clear_table('payables'); \n        frm.clear_table('receivables'); \n        frm.clear_table(\"custom_asset_allocation\");\n\n        \n        payables.forEach(function(item, index) {\n            var row = frm.add_child('payables'); \n            row.component = item; \n            row.reference_document_type = payables_doctype[index]; \n        });\n\n        \n        receivables.forEach(function(item, index) {\n            var row = frm.add_child('receivables'); \n            row.component = item; \n            row.reference_document_type = receivables_doctype[index]; \n        });\n\n        \n        if (frm.doc.custom_unserved_notice_days > 0) {\n           \n            frappe.db.get_value('Employee', frm.doc.employee, 'custom_gross_salary_per_month')\n            .then(function(r) {\n                var gross = r.message.custom_gross_salary_per_month;\n                var per_day_dedu = gross / notice_days;\n                var notice_dedu = frm.doc.custom_unserved_notice_days * per_day_dedu;\n                console.log(notice_dedu);\n                \n                var new_row = frm.add_child('receivables');\n                new_row.component = 'Notice Period Deduction';\n                new_row.amount = notice_dedu;\n                \n                frm.refresh_field('receivables');\n                \n            });\n        }\n\n        \n        frm.refresh_field('payables'); \n        frm.refresh_field('receivables'); \n        \n        if (frm.doc.employee){\n            frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    doctype: \"Employee\",\n                    name: frm.doc.employee,\n                    filters: {\n                        fields: [\"custom_allocated_asset_employee\"]\n                    }\n                },\n                callback: function(response) {\n                    if(response.message) {\n                        \n                        $.each(response.message.custom_allocated_asset_employee || [], function(i, row) {\n                            \n                            let new_row = frm.add_child(\"custom_asset_allocation\");\n                            new_row.asset = row.asset; \n                            new_row.department = row.department;\n                            new_row.model_no = row.model_no; \n                            new_row.status = row.status; \n                            new_row.allocation_date = row.allocation_date;\n                            new_row.returned_date = row.returned_date;\n                        });\n    \n                        \n                        frm.refresh_field(\"custom_asset_allocation\");\n                    }\n                }\n                });\n        }\n       \n    },\n    before_save:function(frm){\n        var payable = frm.doc.total_payable_amount;\n        var receivable = frm.doc.total_receivable_amount;\n        \n        var net_pay = payable-receivable;\n        \n        frm.set_value('custom_net_payable_amount', net_pay);\n        frm.refresh_field('custom_net_payable_amount');\n        \n    }\n    \n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Exit Questionnaire",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.020165",
  "module": "Mumal HR",
  "name": "Relieving Date validation in Exit Questionnaire",
  "script": "frappe.ui.form.on('Exit Questionnaire', {\n    employee: function(frm) {\n        var emp = frm.doc.employee;\n        var emp_nm = frm.doc.employee_name;\n        \n        if (emp) {\n            frappe.db.get_value('Employee', emp, 'relieving_date').then(function(res) {\n                var relieving_date = res.message.relieving_date;\n                \n                if (!relieving_date) {\n                    var message = __(\"Please set relieving date in Employee: {0} - {1}\", [emp, emp_nm]);\n                    frappe.throw(message);\n                }\n            });\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Job Requisition",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.067387",
  "module": "Mumal HR",
  "name": "Set default designation in authorities child table",
  "script": "frappe.ui.form.on('Job Requisition', {\n    refresh: function(frm) {\n        if (frm.is_new()) {\n            frappe.call({\n                method: \"frappe.client.get_list\",\n                args: {\n                    doctype: \"Designation\",\n                    fields: [\"name\"],\n                    filters: {\n                        name: [\"in\", ['HR Manager', 'Head of Department', 'Managing Director']]\n                    }\n                },\n                callback: function(response) {\n                    if (response.message) {\n                       \n                        var orderedDesignations = ['HR Manager', 'Head of Department', 'Managing Director'];\n\n                      \n                        for (var i = 0; i < orderedDesignations.length; i++) {\n                            var designationName = orderedDesignations[i];\n\n                          \n                            if (response.message.find(row => row.name === designationName)) {\n                                var row = frm.add_child(\"custom_authoroties_comments\");\n                                row.designation = designationName;\n                            }\n                        }\n                        frm.refresh_field(\"custom_authoroties_comments\");\n                    }\n                }\n            });\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Full and Final Statement",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.134083",
  "module": "Mumal HR",
  "name": "Fetch the gratuity amount in F&F",
  "script": "frappe.ui.form.on('Full and Final Outstanding Statement', {\n    reference_document: function(frm, cdt, cdn) {\n        var child = locals[cdt][cdn];\n        var ref_doc_type = child.reference_document_type;\n        var ref_doc = child.reference_document;\n        \n        if(ref_doc_type=='Employee Gratuity')\n        {\n            frappe.db.get_value('Employee Gratuity', ref_doc, 'amount')\n            .then(function(records) {\n                \n                \n                if (records && records.message) {\n                    var gratuity_amount = records.message.amount;\n                    console.log(gratuity_amount);\n                    \n                    frappe.model.set_value(cdt, cdn, 'amount', gratuity_amount);\n                    frm.refresh_field('payables');  \n                    frm.refresh_field('receivables');  \n                }\n            });\n            \n        }\n        if(ref_doc_type=='Employee Bonus')\n        {\n            frappe.db.get_value('Employee Bonus', ref_doc, 'bonus_amount')\n            .then(function(records) {\n                \n                \n                if (records && records.message) {\n                    var bonus_amount = records.message.bonus_amount;\n                    console.log(bonus_amount);\n                    \n                    frappe.model.set_value(cdt, cdn, 'amount', bonus_amount);\n                    frm.refresh_field('payables');  \n                    frm.refresh_field('receivables');  \n                }\n            });\n            \n        }\n        \n        \n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Increment",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.153347",
  "module": "Mumal HR",
  "name": "Set Increment Amount in Employee Increment",
  "script": "frappe.ui.form.on('Employee Increment', {\n\tincrement_percentage:function(frm) {\n\t    var gross = frm.doc.current_gross;\n\t\tvar inc_per = frm.doc.increment_percentage;\n\t\t\n\t\tif(gross && inc_per){\n\t\t    var inc_amount = gross*inc_per/100;\n\t\t    \n\t\t    frm.set_value('increment_amount', inc_amount);\n\t\t    frm.refresh_field('increment_amount');\n\t\t    \n\t\t    var new_gross = gross+inc_amount;\n\t\t    \n\t\t    frm.set_value('new_gross', new_gross);\n\t\t    frm.refresh_field('new_gross');\n\t\t}\n\t\t\n\t},\n\tincrement_amount:function(frm){\n\t   var gross = frm.doc.current_gross;\n        var inc_amount = frm.doc.increment_amount;\n\n        if (gross && inc_amount) {\n            var inc_per = (inc_amount / gross) * 100;\n            frm.set_value('increment_percentage', inc_per);\n            frm.refresh_field('increment_percentage');\n\n            var new_gross = gross + inc_amount;\n            frm.set_value('new_gross', new_gross);\n            frm.refresh_field('new_gross');\n        }\n\t    \n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Bonus",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.188491",
  "module": "Mumal HR",
  "name": "Fetch Bonus Component in Employee Bonus",
  "script": "frappe.ui.form.on('Employee Bonus', {\n\trefresh(frm) {\n\t\tfrappe.db.get_list('Salary Component', {\n            fields: ['name'], \n            filters: { \n                'custom_earning_type':'Bonus'\n            }\n        }).then(function(records) {\n            var ans = records[0].name;\n            console.log(ans);\n            frm.set_value('salary_component',ans);\n            frm.refresh_field('salary_component');\n        });\n\t}\n});\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Appraisal",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.227040",
  "module": "Mumal HR",
  "name": "Auto set appraisal criteria",
  "script": "frappe.ui.form.on('Employee Appraisal', {\n\tonload: function(frm) {\n\t\tif (frm.is_new()) {\n            var score = [\n                \"More then >90\",\n                \"89-79\",\n                \"79-69\",\n                \"69-55\",\n                \"Below Average >55\"\n            ];\n            var remarks = [\n                \"Outstanding\",\n                \"Very Good\",\n                \"Good\",\n                \"Average\",\n                \"Poor\"\n            ];\n            \n            if (!frm.doc.default_criteria) {\n                frm.doc.default_criteria = [];\n            }\n\n            var existing_row = frm.doc.default_criteria.map(function(row) {\n                return row.average_score;\n            });\n\n            for (var i = 0; i < score.length; i++) {\n                if (!existing_row.includes(score[i])) {\n                    var row = frm.add_child(\"default_criteria\");\n                    row.average_score = score[i];\n                    if (i < remarks.length) {\n                        row.performance_remarks = remarks[i];\n                    }\n                }\n            }\n            frm.refresh_field(\"default_criteria\");\n\t\t}\n\t\t\n\t}\n})\n\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Appraisal",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.244472",
  "module": "Mumal HR",
  "name": "Set KRA in Employee Appraisal",
  "script": "frappe.ui.form.on('Employee Appraisal', {\n    appraisal_template: function(frm) {\n        var app_tem = frm.doc.appraisal_template;\n\n        if (app_tem) {\n            frm.clear_table(\"appraisal_ratings\");\n\n            frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    doctype: \"Appraisal Template\",\n                    name: app_tem\n                },\n                callback: function(r) {\n                    if (r.message) {\n                        var total_max_score = 0;\n\n                        $.each(r.message.custom_kra_mapping || [], function(i, row) {\n                            var new_row = frm.add_child(\"appraisal_ratings\");\n                            new_row.review_area = row.feedback_criteria;\n                            new_row.rating_factor = row.kra;\n                            new_row.max_score = row.max_score;\n\n                            // Add max_score to total\n                            total_max_score += row.max_score;\n                        });\n\n                        // Set the total_max_score in the parent field\n                        frm.set_value('total_max_score', total_max_score);\n                        frm.refresh_field('total_max_score');\n\n                        frm.refresh_field(\"appraisal_ratings\");\n                    }\n                }\n            });\n        }\n    },\n\n    validate: function(frm) {\n        var total_hod_score = 0;\n        var total_hr_manager_score = 0;\n        var total_management_score = 0;\n        var valid = true; // Track if all scores are valid\n\n        $.each(frm.doc.appraisal_ratings || [], function(i, row) {\n            if (row.by_hod > row.max_score) {\n                frappe.msgprint(__('HOD score cannot exceed the max score of {0} for row {1}', [row.max_score, row.idx]));\n                valid = false;\n                return false; // Stop further execution\n            }\n            if (row.by_hr_manager > row.max_score) {\n                frappe.msgprint(__('HR Manager score cannot exceed the max score of {0} for row {1}', [row.max_score, row.idx]));\n                valid = false;\n                return false;\n            }\n            if (row.by_management > row.max_score) {\n                frappe.msgprint(__('Management score cannot exceed the max score of {0} for row {1}', [row.max_score, row.idx]));\n                valid = false;\n                return false;\n            }\n\n            total_hod_score += row.by_hod;\n            total_hr_manager_score += row.by_hr_manager;\n            total_management_score += row.by_management;\n        });\n\n        if (!valid) {\n            frappe.validated = false; // Stop form submission\n            return;\n        }\n\n        // Set the total scores in parent fields\n        frm.set_value('hod_score', total_hod_score);\n        frm.refresh_field('hod_score');\n        frm.set_value('hr_manager_score', total_hr_manager_score);\n        frm.refresh_field('hr_manager_score');\n        frm.set_value('management_score', total_management_score);\n        frm.refresh_field('management_score');\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Self Review Form",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.213524",
  "module": "Mumal HR",
  "name": "Set Questions in Self Review Form",
  "script": "frappe.ui.form.on('Self Review Form', {\n\treview_template:function(frm) {\n\t\tvar review_template = frm.doc.review_template;\n\t\t\n\t\tif (review_template) {\n            frm.clear_table(\"self_review\");\n\n            frappe.call({\n                method: \"frappe.client.get\",\n                args: {\n                    doctype: \"Self Review Template\",\n                    name: review_template\n                },\n                callback: function(r) {\n                    if (r.message) {\n\n                        $.each(r.message.self_review_qestions || [], function(i, row) {\n                            var new_row = frm.add_child(\"self_review\");\n                            new_row.question = row.question;\n                            new_row.answer = row.answer;\n\n                        });\n\n                        frm.refresh_field(\"self_review\");\n                    }\n                }\n            });\n        }\n\t}\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Appraisal",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.264215",
  "module": "Mumal HR",
  "name": "Set Score Field Readonly based on role",
  "script": "frappe.ui.form.on('Employee Appraisal', {\n    refresh: function(frm) {\n        const status = frm.doc.status;\n            \n        if (!frappe.user.has_role(\"Administrator\")) {\n            \n            if (frm.is_new()){\n                let status_options = ['Pending'];\n                frm.set_df_property('status', 'options', status_options);\n            }\n                \n        \n    \n            if (!frm.is_new()) {\n                \n                // Ensure Pending status is visible to anyone\n                let status_options = [];\n        \n                // Role-specific status options\n                if (frappe.user.has_role(\"Head of Department\")) {\n                    status_options.push('Pending', 'Approved by HOD', 'Rejected by HOD');\n                }\n                if (frappe.user.has_role(\"HR Manager\")) {\n                    status_options.push('Approved by HR', 'Rejected by HR');\n                }\n                if (frappe.user.has_role(\"Managing Director\")) {\n                    status_options.push('Approved by MD', 'Rejected by MD');\n                }\n                \n                // Set status options based on role\n                frm.set_df_property('status', 'options', status_options);\n        \n                // Make the form read-only if status is Approved or Rejected by MD\n                if (status === 'Approved by MD' || status === 'Rejected by MD') {\n                    frm.set_read_only();\n                    frm.refresh_fields();\n                    return; \n                }\n                \n                \n                if (frappe.user.has_role(\"Head of Department\")) {\n                    if (status !== 'Pending' && status !== 'Rejected by HOD' && status !== 'Approved by HOD') {\n                        frm.set_read_only();\n                        frm.refresh_fields();\n                    }\n                }\n                if (frappe.user.has_role(\"HR Manager\")) {\n                    if (status !== 'Approved by HR' && status !== 'Rejected by HR' && status !== 'Approved by HOD') {\n                        frm.set_read_only();\n                        frm.refresh_fields();\n                    }\n                }\n                if (frappe.user.has_role(\"Managing Director\")) {\n                    if (status !== 'Approved by MD' && status !== 'Rejected by MD' && status !== 'Approved by HR') {\n                        frm.set_read_only();\n                        frm.refresh_fields();\n                    }\n                }\n            }\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Employee Increment",
  "enabled": 0,
  "modified": "2025-02-27 17:02:09.832583",
  "module": "Mumal HR",
  "name": "Workflow based Increment Flow",
  "script": "frappe.ui.form.on('Employee Increment', {\n    refresh: function(frm) {\n        const status = frm.doc.status;\n            \n        if (!frappe.user.has_role(\"Administrator\")) {\n            \n            if (frm.is_new()){\n                let status_options = ['Pending'];\n                frm.set_df_property('status', 'options', status_options);\n            }\n                \n        \n    \n            if (!frm.is_new()) {\n                \n                // Ensure Pending status is visible to anyone\n                let status_options = [];\n        \n                // Role-specific status options\n                if (frappe.user.has_role(\"Head of Department\")) {\n                    status_options.push('Pending', 'Approved by HOD', 'Rejected by HOD');\n                }\n                if (frappe.user.has_role(\"HR Manager\")) {\n                    status_options.push('Approved by HR', 'Rejected by HR');\n                }\n                if (frappe.user.has_role(\"Managing Director\")) {\n                    status_options.push('Approved by MD', 'Rejected by MD');\n                }\n                \n                // Set status options based on role\n                frm.set_df_property('status', 'options', status_options);\n        \n                // Make the form read-only if status is Approved or Rejected by MD\n                if (status === 'Approved by MD' || status === 'Rejected by MD') {\n                    frm.set_read_only();\n                    frm.refresh_fields();\n                    return; \n                }\n                \n                \n                if (frappe.user.has_role(\"Head of Department\")) {\n                    if (status !== 'Pending' && status !== 'Rejected by HOD' && status !== 'Approved by HOD') {\n                        frm.set_read_only();\n                        frm.refresh_fields();\n                    }\n                }\n                if (frappe.user.has_role(\"HR Manager\")) {\n                    if (status !== 'Approved by HR' && status !== 'Rejected by HR' && status !== 'Approved by HOD') {\n                        frm.set_read_only();\n                        frm.refresh_fields();\n                    }\n                }\n                if (frappe.user.has_role(\"Managing Director\")) {\n                    if (status !== 'Approved by MD' && status !== 'Rejected by MD' && status !== 'Approved by HR') {\n                        frm.set_read_only();\n                        frm.refresh_fields();\n                    }\n                }\n            }\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Shift Type",
  "enabled": 1,
  "modified": "2025-02-27 15:57:33.594223",
  "module": "Mumal HR",
  "name": "custom attendance via Get attendance button",
  "script": "frappe.ui.form.on('Shift Type', {\n\trefresh:function(frm) {\n\n    // Hide Default Mark Attendance Button\n    $('[data-label=\"Mark%20Attendance\"]').hide();\n    \n    \n    frm.add_custom_button(__(\"Get Attendance\"), function() {\n        var from_date = frm.doc.process_attendance_after;\n        var shift = frm.doc.name;\n        var shift_type = frm.doc.type;\n        var batchSize = 3; \n\n        \n        frappe.call({\n            method: \"mumal_hr.api.mark_attendance\",\n            args: {\n                \"date\": from_date,\n                \"shift\": shift,\n                freeze: true,\n                freeze_message: \"Please wait ..\"\n            },\n            callback: function(r) {\n                var res = r.message;\n                console.log(r)\n                // res.forEach(function(message) {\n                //     frappe.msgprint(message);\n                // });\n               \n            }\n        });\n    });\n\t},\n\tprocess_attendance_after: function(frm) {\n        frm.save();\n    }\n\t\n});\n\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Shift Type",
  "enabled": 1,
  "modified": "2024-09-30 08:22:01.312167",
  "module": "Mumal HR",
  "name": "Calculate Shifthours",
  "script": "frappe.ui.form.on('Shift Type', {\nstart_time: function (cur_frm, cdt, cdn) {\n    var d = locals[cdt][cdn];\n    var hours=0;\n    var minutes=0;\n    var seconds=0;\n    console.log(cdt, cdn, d.start_time, d.end_time, d.custom_shift_hours);\n\n    if (d.start_time && d.end_time) {\n        \n\t\t\n\t    var hour1 = d.start_time.split(':')[0];\n        var hour2 = d.end_time.split(':')[0];\n        var min1 = d.start_time.split(':')[1];\n        var min2 = d.end_time.split(':')[1];\n\t\tvar sec1 = d.start_time.split(':')[2];\n        var sec2 = d.end_time.split(':')[2];\n\t\t\n\t\tvar diff_hour = hour2 - hour1;\n\t\tvar diff_min = min2 - min1;\n\t\tvar diff_sec = sec2 - sec1;\n\t\t\n\t\tif (diff_hour<0) {\n            diff_hour+= 24;\n        }\n        if (diff_min<0) {\n            diff_min+=60;\n            diff_hour--;\n        }if(diff_min>=60){\n            diff_min-=60;\n            diff_hour++;\n        }\n        if (diff_sec<0) {\n            diff_sec+=60;\n            diff_min--;\n        } else if(diff_sec>=60){\n            diff_sec-=60;\n            diff_min++;\n        }\n\t\n        \n       frappe.model.set_value(cdt,cdn,\"custom_shift_hours\",diff_hour+\":\"+diff_min+\":\"+diff_sec);\n\t   frm.refresh_field(\"custom_shift_hours\");\n    }\n},\nend_time: function (cur_frm, cdt, cdn) {\n    var d = locals[cdt][cdn];\n    var hours=0;\n    var minutes=0;\n    var seconds=0;\n    console.log(cdt, cdn, d.start_time, d.end_time, d.custom_shift_hours);\n\n    if (d.start_time && d.end_time) {\n        \n\t\t\n\t    var hour1 = d.start_time.split(':')[0];\n        var hour2 = d.end_time.split(':')[0];\n        var min1 = d.start_time.split(':')[1];\n        var min2 = d.end_time.split(':')[1];\n\t\tvar sec1 = d.start_time.split(':')[2];\n        var sec2 = d.end_time.split(':')[2];\n\t\t\n\t\tvar diff_hour = hour2 - hour1;\n\t\tvar diff_min = min2 - min1;\n\t\tvar diff_sec = sec2 - sec1;\n\t\t\n\t\tif (diff_hour<0) {\n            diff_hour+= 24;\n        }\n        if (diff_min<0) {\n            diff_min+=60;\n            diff_hour--;\n        }if(diff_min>=60){\n            diff_min-=60;\n            diff_hour++;\n        }\n        if (diff_sec<0) {\n            diff_sec+=60;\n            diff_min--;\n        } else if(diff_sec>=60){\n            diff_sec-=60;\n            diff_min++;\n        }\n\t\t\n      frappe.model.set_value(cdt,cdn,\"custom_shift_hours\",diff_hour+\":\"+diff_min+\":\"+diff_sec);\n\t   frm.refresh_field(\"custom_shift_hours\");\n    }\n}\n\n\n});",
  "view": "Form"
 }
]